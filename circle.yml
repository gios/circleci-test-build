machine:
  node:
    version: 8.1.2

dependencies:
  pre:
    - cd ui && npm i
    - cd ui && ./node_modules/.bin/ng build
  post:
    - mkdir static
    - mv -v ui/dist/* static
    - sudo rsync -av * $CIRCLE_ARTIFACTS --exclude=mom-and-i --exclude=ui
  post:
    - git config user.name $GIT_NAME
    - git config user.email $GIT_EMAIL
    - git add -A
    - git commit -m "build"

deployment:
  staging:
    branch: heroku
    heroku:
      appname: mom-and-i
